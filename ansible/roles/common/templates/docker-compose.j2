version: '2'

services:
  mysql:
    image: mysql:8.0
    command: mysqld --default-authentication-plugin=mysql_native_password
    ports:
      - 8083:3306
    environment:
      MYSQL_ROOT_PASSWORD: {{ mysql_root_password }}
  cce:
    image: cce:latest
    build:
      context: .
      dockerfile: docker/run/Dockerfile
    depends_on:
      - mysql
    command: {{ cce_flags }}
    ports:
      - 8080:8080
      - 8081:8081
      - 6514:6514
      - 8125:8125
    volumes:
      - {{ remote_root }}/artifacts/syslog.log:/syslog.log
      - {{ remote_root }}/artifacts/statsd.log:/statsd.log
      - {{ remote_root }}/artifacts:/certificates/ca
  ui:
    image: ui:latest
    build:
      context: ./ui/controller
      args:
        REACT_APP_CONTROLLER_API: {{ react_app_controller_api }}
    ports:
      - 3000:80/tcp
    environment:
      REACT_APP_CONTROLLER_API: {{ react_app_controller_api }}
  cups-ui:
    build:
      context: ./ui/cups
      args:
        REACT_APP_CUPS_API: {{ react_app_cups_api }}
    ports:
      - 3010:80/tcp
    environment:
      REACT_APP_CUPS_API: {{ react_app_cups_api }}

